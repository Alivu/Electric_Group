<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
    <meta property="og:title" content="–ß–∞—Ç –≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –°–æ–æ–±—â–µ—Å—Ç–≤–∞ ¬´Electric Group¬ª">
    <meta property="og:description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤. –û–±—Å—É–∂–¥–µ–Ω–∏–µ, –ø–æ–º–æ—â—å, —Ä–µ—à–µ–Ω–∏—è.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://alivu.github.io/Electric_Group/">
    <meta property="og:image" content="https://alivu.github.io/Icon/icon-512x512.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="–ß–∞—Ç –≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –°–æ–æ–±—â–µ—Å—Ç–≤–∞ ¬´Electric Group¬ª">
    <meta name="twitter:description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤. –û–±—Å—É–∂–¥–µ–Ω–∏–µ, –ø–æ–º–æ—â—å, —Ä–µ—à–µ–Ω–∏—è.">
    <meta name="twitter:image" content="https://alivu.github.io/Icon/icon-512x512.png">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }


/* –ê–í–ê–¢–ê–†–ö–ê –°–õ–ï–í–ê (—É–º–µ–Ω—å—à–µ–Ω–∞ –≤ 5 —Ä–∞–∑) */
.message-avatar-left {
    width: 45px;     /* –ë—ã–ª–æ 45px √∑ 5 = 9px */
    height: 45px;    /* –ë—ã–ª–æ 45px √∑ 5 = 9px */
    border-radius: 50%;
    overflow: hidden;
    border: 1px solid #2c5364; /* –£–º–µ–Ω—å—à–∏–ª –≥—Ä–∞–Ω–∏—Ü—É */
    flex-shrink: 0;
    margin-top: 3px; /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø */
}

/* –î–ª—è –∏–Ω–∏—Ü–∏–∞–ª–æ–≤ –≤ –∞–≤–∞—Ç–∞—Ä–µ (–µ—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ) */
.message-avatar-left div {
    font-size: 1.2em; /* –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç */
    font-weight: bold;
}
        
        /* –ò–ú–Ø –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø –í–ù–£–¢–†–ò –†–ê–ú–ö–ò */

    font-weight: 600;
    color: #2c5364;
    font-size: 0.8em;           /* –ß—É—Ç—å —É–º–µ–Ω—å—à–∏–ª Arbi Israilov*/
    margin: 5px 0 8px 0;        /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –≤–µ—Ä—Ö–Ω–∏–π */
    padding-left: 5px;
    font-style: italic;
    border-bottom: 1px solid rgba(44, 83, 100, 0.1);
    padding-bottom: 5px;        /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
    transform: translateY(-1px); /* –ü–û–î–ù–ò–ú–ê–ï–ú –í–í–ï–†–• */
    position: relative;
    z-index: 2;
}
/* –î–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å–ø—Ä–∞–≤–∞ (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö) */
.message.sent .message-sender-inside {
    color: white;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    text-align: right;
    padding-right: 5px;
    padding-left: 0;
}
        /* –°–¢–ò–õ–ò –î–õ–Ø –ê–£–î–ò–û–ó–ê–ü–ò–°–ò */
        .audio-btn {
            background: linear-gradient(135deg, #FF9800 0%, #FF5722 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 5px;
        }

        .audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }

        .audio-btn.recording {
            background: #dc3545;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .audio-recording-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .audio-recording-modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .recording-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #dc3545;
            font-weight: bold;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .recording-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c5364;
            font-family: monospace;
        }

        .audio-visualizer {
            height: 100px;
            margin: 25px 0;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 3px;
        }

        .visualizer-bar {
            width: 8px;
            background: linear-gradient(to top, #2c5364, #4CAF50);
            border-radius: 4px 4px 0 0;
            min-height: 5px;
        }

        .recording-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .cancel-recording-btn, .stop-recording-btn {
            padding: 12px 25px;
            border-radius: 25px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .cancel-recording-btn {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #ddd;
        }

        .cancel-recording-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .stop-recording-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border: 2px solid #4CAF50;
        }

        .stop-recording-btn:hover {
            background: linear-gradient(135deg, #45a049 0%, #1B5E20 100%);
            transform: translateY(-2px);
        }

        .recording-tip {
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .audio-preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .audio-preview-modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .audio-preview-modal h3 {
            color: #2c5364;
            margin-bottom: 25px;
        }

        .audio-player {
            margin: 25px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
        }

        .audio-player audio {
            flex: 1;
            max-width: 300px;
        }

        .audio-duration {
            font-weight: bold;
            color: #2c5364;
            min-width: 50px;
        }

        .preview-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
        }

        .delete-audio-btn, .send-audio-btn {
            padding: 12px 30px;
            border-radius: 25px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .delete-audio-btn {
            background: #f8f9fa;
            color: #dc3545;
            border: 2px solid #dc3545;
        }

        .delete-audio-btn:hover {
            background: #dc3545;
            color: white;
            transform: translateY(-2px);
        }

        .send-audio-btn {
            background: linear-gradient(135deg, #2c5364 0%, #203a43 100%);
            color: white;
            border: 2px solid #2c5364;
        }

        .send-audio-btn:hover {
            background: linear-gradient(135deg, #203a43 0%, #0f2027 100%);
            transform: translateY(-2px);
        }

        .audio-info {
            color: #666;
            font-size: 0.9rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .audio-message {
            margin-top: 10px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            border: 1px solid #e9ecef;
        }

        .audio-message audio {
            width: 100%;
            max-width: 300px;
        }

        .audio-message-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
        }

.quote-preview {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(56, 142, 60, 0.1) 100%);
    border-left: 4px solid #4CAF50;
    padding: 12px 15px;
    border-radius: 8px;
    position: fixed;
    bottom: 150px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 50px);
    max-width: 800px;
    z-index: 100;
    display: none;
    box-shadow: 0 -2px 10px rgba(76, 175, 80, 0.15);
    box-sizing: border-box;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

        .quote-content {
            position: relative;
            padding-right: 25px;
        }

.quote-content strong {
    color: #22150F; /* –¢–µ–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —à–µ–∫–æ–ª–∞–¥ */
    font-size: 0.9em;
    font-weight: 600;
    display: block;
    margin-bottom: 4px;
}

.quote-content span {
    color: #666666; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π –≤–º–µ—Å—Ç–æ*/
    font-size: 0.9em;
    line-height: 1.4;
    display: block;
    word-break: break-word;
    font-style: italic;
}

.cancel-quote-btn {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #4CAF50;
    border: 2px solid white;
    color: white;
    cursor: pointer;
    font-size: 16px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
    transition: all 0.3s ease;
}

.cancel-quote-btn:hover {
    background: #45a049;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 3px 8px rgba(76, 175, 80, 0.4);
}

.quoted-message {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.12) 0%, rgba(56, 142, 60, 0.08) 100%);
    border-left: 3px solid #4CAF50; /* –Ø—Ä–∫–æ-–∑–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞ */
    padding: 12px 15px;
    margin-bottom: 12px;
    border-radius: 10px;
    font-size: 0.85em;
    max-width: 100%;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(102, 187, 106, 0.1);
    position: relative;
}
/* –°—Ç–∏–ª–∏ –¥–ª—è —Ü–∏—Ç–∞—Ç—ã –∞—É–¥–∏–æ */
.quoted-message.audio-quote {
    background: rgba(255, 255, 255, 0.7);
    border-left: 3px solid #4CAF50;
    padding: 10px 12px;
    margin-bottom: 12px;
    border-radius: 8px;
}

.quoted-message.audio-quote .quote-author {
    font-weight: 600;
    font-size: 0.95em;
}       
.quote-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
    padding-bottom: 6px;
    border-bottom: 1px solid rgba(76, 175, 80, 0.2);
}
.quote-title {
    font-size: 0.8em;
    color: #444444;
    font-style: italic;
    display: flex;
    align-items: center;
    gap: 5px;
}
.quote-title::before {
    content: "‚Ü™Ô∏è";
    font-size: 0.9em;
    opacity: 0.7;
}
 .quote-author {
    font-weight: 600;
    color: #22150F; /* —Ç—ë–º–Ω—ã–π –∫—Ä–∞—Å–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
    font-size: 0.9em;
    margin-bottom: 5px;
    display: block;
}       

.quote-text {
    color: #444444; /* –±–æ–ª–µ–µ —Ç—ë–º–Ω–æ-—Å–µ—Ä–æ–µ: */
    line-height: 1.4;
    font-style: italic;
    display: block;
    word-break: break-word;
    opacity: 0.9;
}

.quote-audio-content {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 8px;
    padding: 8px 10px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 6px;
}

.audio-icon {
    font-size: 1.2em;
}
.audio-duration-quote {
    color: #666;
    font-size: 0.9em;
    font-weight: bold;
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞—É–¥–∏–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
.audio-message-main {
    background: linear-gradient(135deg, rgba(44, 83, 100, 0.1) 0%, rgba(32, 58, 67, 0.05) 100%);
    border-radius: 12px;
    padding: 15px;
    margin-top: 8px;
}
        /* –ê—É–¥–∏–æ–ø–ª–µ–µ—Ä */
.audio-player-controls {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
}

.play-pause-btn {
    /* –û–°–ù–û–í–ù–´–ï –°–í–û–ô–°–¢–í–ê */
    background: #f8f9fa;                /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç */
    color: #2c5364;                     /* –¢–µ–º–Ω—ã–π —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –∏–∫–æ–Ω–∫–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º–µ —á–∞—Ç–∞) */
    border: 2px solid #dee2e6;          /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä–∞—è —Ä–∞–º–∫–∞ - —Ç–æ–Ω–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç —Ñ–æ–Ω–∞ */
    
    /* –†–ê–ó–ú–ï–† –ò –§–û–†–ú–ê */
    width: 36px;                        /* –î–∏–∞–º–µ—Ç—Ä –∫–Ω–æ–ø–∫–∏ - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è –ø–∞–ª—å—Ü–µ–º */
    height: 36px;                       /* –í—ã—Å–æ—Ç–∞ —Ä–∞–≤–Ω–∞ —à–∏—Ä–∏–Ω–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫—Ä—É–≥–∞ */
    border-radius: 50%;                 /* –î–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∏–¥–µ–∞–ª—å–Ω–æ –∫—Ä—É–≥–ª–æ–π (50% –æ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤) */
    
    /* –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï –°–û–î–ï–†–ñ–ò–ú–û–ì–û */
    display: flex;                      /* –í–∫–ª—é—á–∞–µ–º Flexbox –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
    align-items: center;                /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
    justify-content: center;            /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    
    /* –¢–ï–ö–°–¢/–ò–ö–û–ù–ö–ê */
    font-size: 1.1em;                   /* –†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –±–∞–∑–æ–≤–æ–≥–æ */
    flex-shrink: 0;                     /* –ó–∞–ø—Ä–µ—â–∞–µ–º —Å–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –º–µ—Å—Ç–∞ */
    
    /* –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–°–¢–¨ */
    cursor: pointer;                    /* –ú–µ–Ω—è–µ–º –∫—É—Ä—Å–æ—Ä –Ω–∞ "—Ä—É–∫—É" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    transition: all 0.3s;               /* –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ –∑–∞ 0.3 —Å–µ–∫—É–Ω–¥—ã */
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* –õ–µ–≥–∫–∞—è —Ç–µ–Ω—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–º–∞ */
}

/* –≠–§–§–ï–ö–¢ –ü–†–ò –ù–ê–í–ï–î–ï–ù–ò–ò –ö–£–†–°–û–†–ê */
.play-pause-btn:hover {
    background: #ffffff;                /* –ú–µ–Ω—è–µ–º —Ñ–æ–Ω –Ω–∞ —á–∏—Å—Ç–æ –±–µ–ª—ã–π */
    transform: scale(1.05);             /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ 5% */
    border-color: #2c5364;              /* –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–º—ã */
    box-shadow: 0 4px 12px rgba(44, 83, 100, 0.15); /* –£—Å–∏–ª–∏–≤–∞–µ–º —Ç–µ–Ω—å */
}

/* –≠–§–§–ï–ö–¢ –ü–†–ò –ù–ê–ñ–ê–¢–ò–ò (–ê–ö–¢–ò–í–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï) */
.play-pause-btn:active {
    transform: scale(0.98);             /* –õ–µ–≥–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ (—ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è) */
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* –£–º–µ–Ω—å—à–∞–µ–º —Ç–µ–Ω—å */
}
  /* –°–û–°–¢–û–Ø–ù–ò–ï –ö–û–ì–î–ê –ê–£–î–ò–û –í–û–°–ü–†–û–ò–ó–í–û–î–ò–¢–°–Ø */
.play-pause-btn.playing {
    background: #2c5364;                /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º–µ */
    color: white;                       /* –ë–µ–ª–∞—è –∏–∫–æ–Ω–∫–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
    border-color: #2c5364;              /* –†–∞–º–∫–∞ —Ç–æ–≥–æ –∂–µ —Ü–≤–µ—Ç–∞ —á—Ç–æ –∏ —Ñ–æ–Ω */
}      
.audio-waveform-container {
    position: relative;
    flex: 1;
    height: 40px;
    background: rgba(44, 83, 100, 0.1);
    border-radius: 20px;
    cursor: pointer;
    overflow: hidden;
}
.play-icon {
    color: #2c5364;
    font-size: 1.5em;
    font-weight: bold;
    min-width: 30px;
}
.audio-waveform {
    display: flex;
    align-items: center;
    gap: 3px;
    height: 100%;
    padding: 0 15px;
    position: relative;
    z-index: 1;
}
/* –í–ù–ï–®–ù–Ø–Ø –†–ê–ú–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø –° –¶–ò–¢–ê–¢–û–ô (300px) */
.message-with-quote {
    width: 300px;    /* –ë—ã–ª–æ 320px √∑ 3 = 107px */
    height: 160px;   /* –ë—ã–ª–æ 300px √∑ 3 = 100px */
    border: 1px solid #2c5364; /* –£–º–µ–Ω—å—à–∏–ª –≥—Ä–∞–Ω–∏—Ü—É */
    border-radius: 6px; /* –£–º–µ–Ω—å—à–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
    padding: 4px;    /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
    background: white;
    box-shadow: 0 2px 6px rgba(44, 83, 100, 0.1);
    font-size: 1.2em; /* –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç */
}

/* –†–ê–ú–ö–ê –¶–ò–¢–ê–¢–´ (135px, —Å–µ—Ä–æ–≤–∞—Ç–∞—è) */
.quote-frame {
    width: calc(100% - 6px); /* –ë—ã–ª–æ 10px √∑ 3 ‚âà 3px √ó 2 = 6px */
    height: 50px;    /* –ë—ã–ª–æ 135px √∑ 3 = 45px */
    margin: 2px;     /* –ë—ã–ª–æ 5px √∑ 3 ‚âà 2px */
    border: 0.5px solid #e0e0e0; /* –£–º–µ–Ω—å—à–∏–ª –≥—Ä–∞–Ω–∏—Ü—É */
    border-radius: 4px; /* –£–º–µ–Ω—å—à–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
    background: rgba(240, 240, 240, 0.7);
    padding: 5px;    /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
}

.inner-quote-frame {
    text-align: left;
    margin-left: 3px;      /* –í–Ω–µ—à–Ω–∏–π –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ */
    margin-top: -7px;       /* –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –ø–æ–¥–Ω–∏–º–µ—Ç –±–ª–æ–∫ */
}

.quote-author-inner {
    font-weight: 600;
    color: #1B5E20;
    font-size: 1em;
    margin-bottom: 8px;
}

.quote-audio-info {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* –ò–∑–º–µ–Ω–∏–ª —Å center –Ω–∞ flex-start –¥–ª—è —Å–¥–≤–∏–≥–∞ –≤–ª–µ–≤–æ */
    gap: 6px;                    /* –£–º–µ–Ω—å—à–∏–ª —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º */
    color: #666;
    font-size: 0.8em;            /* –ß—É—Ç—å —É–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç */
    text-align: left;
    margin-left: -8px;           /* –£–í–ï–õ–ò–ß–ò–õ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è —Å–¥–≤–∏–≥–∞ –≤–ª–µ–≤–æ */
    margin-top: -9px;           /* –£–í–ï–õ–ò–ß–ò–õ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–æ–¥—ä–µ–º–∞ */
    transform: translateY(0px); /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–¥—ä–µ–º */
    padding-left: 5px;           /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ */
}

.quote-audio-icon {
    font-size: 1em;
    margin-top: -1px;           /* –£–í–ï–õ–ò–ß–ò–õ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–æ–¥—ä–µ–º–∞ */
}

.quote-text-inner {
    color: #555;
    font-size: 0.9em;
    line-height: 1.4;
}

/* –ò–ú–Ø –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø (–ø–æ–¥ —Ä–∞–º–∫–æ–π —Ü–∏—Ç–∞—Ç—ã) */
.message-sender {
    font-weight: 600;
    color: #2c5364;
    font-size: 1em;
    margin: 15px 0 10px 0;
    padding-left: 5px;
}

/* –†–ê–ú–ö–ê –ê–£–î–ò–û –ü–õ–ï–ô–ï–†–ê (160px) */
.audio-player-frame {
    height: 70px;    /* –ë—ã–ª–æ 160px √∑ 3 = 53px */
    padding: 6px;    /* –ë—ã–ª–æ 15px √∑ 3 = 5px */
    border: none;                /* –£–±—Ä–∞—Ç—å —Ä–∞–º–∫—É */
    border-radius: 5px; /* –£–º–µ–Ω—å—à–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
    background: none;           /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
    box-shadow: none;           /* –£–±—Ä–∞—Ç—å —Ç–µ–Ω—å */
    display: flex;
    flex-direction: column;
    justify-content: center; 
    margin-top: 2px;             /* –î–æ–±–∞–≤–∏–ª –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É (–æ–ø—É—Å–∫–∞–µ–º) */
    transform: translateY(-8px);   /* –û–ø—É—Å–∫–∞–µ–º –≤–µ—Å—å –ø–ª–µ–µ—Ä */
}

/* –°–¢–†–û–ö–ê –° –ö–ù–û–ü–ö–û–ô –ò –í–û–õ–ù–û–ô */
.audio-controls-row {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
    transform: translateY(10px);   /* –û–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫—É */
}

/* –ö–ù–û–ü–ö–ê –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø */
.play-btn-audio {
    background: #e8f2fc;
    border: 2px solid #2c5364;
    color: #9fa0a1;
    width: 30px;     /* –ë—ã–ª–æ 40px √∑ 3 = 13px */
    height: 30px;    /* –ë—ã–ª–æ 40px √∑ 3 = 13px */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s;
    flex-shrink: 0;
    padding: 0;
    border: none;
    font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª –∏–∫–æ–Ω–∫—É */
}

.play-btn-audio:hover {
    background: #2c5364;
    color: white;
    transform: scale(1.05);
}
.message.sent .play-btn-audio:hover {
    background: white;
    color: #203a43;
}
/* –ö–û–ù–¢–ï–ô–ù–ï–† –í–û–õ–ù–´ */
.waveform-container {
    display: flex;
    align-items: flex-end;
    gap: 2px;
    height: 30px;    /* –ë—ã–ª–æ 36px √∑ 3 = 12px */
    flex: 1;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 6px; /* –£–º–µ–Ω—å—à–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
    padding: 0 4px;  /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
    border: 1px solid #e9ecef;
}
.wave-bar {
    width: 1px;      /* –ë—ã–ª–æ 3px √∑ 3 = 1px */
    background: linear-gradient(to top, #2c5364, #4CAF50);
    border-radius: 0.5px; /* –£–º–µ–Ω—å—à–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
    min-height: 2px; /* –ë—ã–ª–æ 6px √∑ 3 = 2px */
    transition: height 0.2s;
    
}
  /* –°–¢–†–û–ö–ê –° –í–†–ï–ú–ï–ù–ï–ú */
.audio-time-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 2px;  /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
    font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç */
}      
.audio-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: rgba(76, 175, 80, 0.2);
    width: 0%;
    border-radius: 20px;
    z-index: 0;
    transition: width 0.1s;
}
        
.audio-info-main {
    display: flex;
    align-items: center;
    gap: 15px;
    padding-top: 8px;
    border-top: 1px solid rgba(44, 83, 100, 0.1);
    font-size: 0.9em;
}
.audio-current-time {
    color: #2c5364;
    font-weight: bold;
    min-width: 40px;
}

        
.audio-info {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 0.8em;
    color: #666;
    margin-top: 5px;
}
.audio-duration-main {
    color: #666;
    min-width: 40px;
}

.audio-duration {
    color: #2c5364;
    font-weight: bold;
    font-size: 1em;
}

.message-time-audio {
    color: #666;
    font-size: 0.9em;
}
        /* –ü–†–û–°–¢–ê–Ø –†–ê–ú–ö–ê –ë–ï–ó –¶–ò–¢–ê–¢–´ */
.simple-audio-frame {
    width: 300px;     /* –ë—ã–ª–æ 280px √∑ 3 = 93px */
    min-height: 100px; /* –ë—ã–ª–æ 180px √∑ 3 = 60px */
    border: 1px solid #2c5364;
    border-radius: 6px;
    padding: 6px;
    background: white;
    box-shadow: 0 4px 12px rgba(44, 83, 100, 0.1);
    font-size: 1.2em; /* –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç */
}
        /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –∏–º–µ–Ω–µ–º –∏ —Ç–µ–∫—Å—Ç–æ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö */
.message-text-content {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid rgba(44, 83, 100, 0.1);
}
     .text-message-frame {
    max-width: 300px; /* –ë—ã–ª–æ 400px √∑ 3 = 133px */
    min-width: 50px;  /* –ë—ã–ª–æ 200px √∑ 3 = 67px */
    padding: 6px;    /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
    border-radius: 9px; /* –£–º–µ–Ω—å—à–∏–ª —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
    background: white;
    border: 1px solid #e9ecef;
    line-height: 1.4;
    word-break: break-word;
    font-size: 1.2em; /* –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç */
}   
.audio-time-sent {
    color: #888;
    margin-left: auto;
}
.audio-player-hidden {
    display: none;
}
.audio-time {
    color: #888;
    font-size: 0.8em;
}
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            margin-right: 10px;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .login-container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #FF9800;
        }

        h1 {
            color: #2c5364;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .online-stats {
            background: linear-gradient(135deg, #2c5364 0%, #203a43 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(44, 83, 100, 0.3);
        }

        .online-count {
            font-size: 3.5rem;
            font-weight: bold;
            display: block;
            line-height: 1;
            margin-bottom: 10px;
        }

        .online-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            background: #4285F4;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 16px 30px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }

        .google-btn:hover {
            background: #3367D6;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(66, 133, 244, 0.4);
        }

        .google-btn img {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            padding: 4px;
        }

        .benefits {
            text-align: left;
            margin-top: 30px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid #FF9800;
        }

        .benefits h3 {
            color: #2c5364;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .benefits ul {
            list-style: none;
            padding: 0;
        }

        .benefits li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            border-bottom: 1px solid #eee;
        }

        .benefits li:last-child {
            border-bottom: none;
        }

        .benefits li:before {
            content: "‚ö°";
            color: #FF9800;
            position: absolute;
            left: 0;
            font-size: 1.2rem;
        }

        .status {
            margin-top: 20px;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        .chat-container {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: none;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, #2c5364 0%, #203a43 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .user-details p {
            margin: 5px 0 0 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .chat-stats {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .online-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .online-dot {
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .logout-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .messages-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            -webkit-overflow-scrolling: touch;
            min-height: 0;
        }

        .message {
            position: relative;
            display: flex;
            flex-direction: column;
            max-width: 70%;
            animation: messageAppear 0.3s ease-out;
            flex-shrink: 0;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.sent {
            align-self: flex-end;
        }

        .message.received {
            align-self: flex-start;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
            padding: 0 10px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            overflow: hidden;
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-author {
            font-weight: 600;
            font-size: 0.9rem;
            color: #2c5364;
        }

        .message-time {
            font-size: 0.8rem;
            color: #888;
        }

        .message-content {
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            line-height: 1.5;
            word-break: break-word;
        }

        .message.sent .message-content {
            background: linear-gradient(135deg, #2c5364 0%, #203a43 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.received .message-content {
            border-bottom-left-radius: 5px;
        }

        .message-actions {
            display: none;
            position: absolute;
            top: 8px;
            right: 10px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 6px 10px;
            z-index: 10;
            opacity: 0;
            transform: translateY(5px);
            transition: opacity 0.2s, transform 0.2s;
        }

        .message.sent:hover .message-actions,
        .message.received:hover .message-actions {
            display: flex;
            gap: 8px;
            opacity: 1;
            transform: translateY(0);
        }

        .edit-btn, .delete-btn {
            background: none;
            border: none;
            padding: 6px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
        }

        .edit-btn {
            color: #2c5364;
            background: rgba(44, 83, 100, 0.1);
            border: 1px solid rgba(44, 83, 100, 0.2);
        }

        .edit-btn:hover {
            background: rgba(44, 83, 100, 0.2);
            transform: translateY(-1px);
        }

        .delete-btn {
            color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.2);
        }

        .delete-btn:hover {
            background: rgba(220, 53, 69, 0.2);
            transform: translateY(-1px);
        }

        .edit-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #2c5364;
            border-radius: 15px;
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            min-height: 70px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .edit-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .save-btn, .cancel-btn {
            padding: 10px 24px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .save-btn {
            background: linear-gradient(135deg, #2c5364 0%, #203a43 100%);
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 83, 100, 0.3);
        }

        .cancel-btn {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #ddd;
        }

        .cancel-btn:hover {
            background: #e9ecef;
        }

        .edited-badge {
            font-size: 0.75rem;
            color: #888;
            font-style: italic;
            margin-left: 8px;
            opacity: 0.8;
        }

        .message-input-area {
            padding: 20px 25px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-shrink: 0;
            position: relative;
        }

        .message-input {
            flex: 1;
            padding: 15px 25px;
            border: 2px solid #e9ecef;
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
            -webkit-appearance: none;
        }

        .message-input:focus {
            border-color: #2c5364;
            box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, #FF9800 0%, #FF5722 100%);
            color: white;
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
            flex-shrink: 0;
        }

        .send-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
        }

        .typing-indicator {
            padding: 10px 20px;
            background: #e9ecef;
            border-radius: 20px;
            margin: 0 25px 15px;
            font-style: italic;
            color: #666;
            display: none;
            flex-shrink: 0;
        }

        .message.system {
            align-self: center;
            max-width: 90%;
            text-align: center;
            margin: 10px 0;
        }

        .message.editing {
            animation: pulseHighlight 2s infinite;
        }

        .message.editing .message-content {
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.4);
            border: 2px solid #FF9800;
            transform: translateY(-2px);
        }

        @keyframes pulseHighlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.01); }
            100% { transform: scale(1); }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 70vh;
            overflow: hidden;
        }

        .modal-header {
            background: #2c5364;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
        }

        .modal-body {
            padding: 20px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .modal-btn {
            background: #2c5364;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .chat-container {
                height: 100vh;
                height: -webkit-fill-available;
                border-radius: 0;
                max-width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .login-container {
                padding: 25px;
                margin: 10px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .online-count {
                font-size: 2.5rem;
            }
            
            .chat-header {
                padding: 8px 15px;
                padding-top: max(8px, env(safe-area-inset-top));
                min-height: 60px;
            }
            
            .user-avatar {
                width: 40px;
                height: 40px;
            }
            
            .user-details h3 {
                font-size: 0.9rem;
                max-width: 120px;
            }
            
            .user-details p {
                font-size: 0.75rem;
                max-width: 120px;
            }
            
            .chat-stats {
                gap: 2px;
                height: 40px;
            }
            
            .online-badge {
                padding: 4px 6px;
                font-size: 0.8rem;
                height: 32px;
            }
            
            .online-dot {
                width: 8px;
                height: 8px;
            }
            
            .back-btn, .logout-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
                height: 32px;
                min-width: 55px;
            }
            
            .messages-container {
                padding: 15px 15px 95px;
            }
            
            .message {
                max-width: 85%;
            }
            
            .message-input-area {
                padding: 12px 15px;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                z-index: 100;
                border-top: 1px solid #e9ecef;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }
            
            .messages-wrapper {
                padding-bottom: calc(70px + env(safe-area-inset-bottom));
            }
            
            .quote-preview {
                position: fixed;
                bottom: 60px;
                left: 15px;
                right: 15px;
                margin: 0 !important;
                padding: 10px 12px;
                z-index: 1000;
                border-radius: 8px 8px 0 0;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }

            .quote-preview:hover {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.2) 0%, rgba(56, 142, 60, 0.15) 100%);
    transform: translateX(-50%) translateY(-2px);
    transition: all 0.3s ease;
    box-shadow: 0 -2px 15px rgba(76, 175, 80, 0.2);
}
            
            .messages-container {
                padding-bottom: 120px !important;
            }
            
            .message-actions {
                top: -12px;
                right: 10px;
                padding: 5px 8px;
            }
            
            .edit-btn, .delete-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
                min-width: 35px;
            }
            
            .message.sent:active .message-actions {
                display: flex;
                opacity: 1;
                transform: translateY(0);
            }
            
            .message.sent .message-content {
                position: relative;
                padding-right: 40px;
            }
            
            .audio-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
                margin-right: 8px;
            }
            
            .audio-recording-modal {
                padding: 20px;
                margin: 15px;
                width: calc(100% - 30px);
            }
            
            .recording-controls {
                flex-direction: column;
            }
            
            .cancel-recording-btn, .stop-recording-btn {
                width: 100%;
            }
            
            .audio-player {
                flex-direction: column;
            }
            
            .preview-controls {
                flex-direction: column;
            }
            
            .delete-audio-btn, .send-audio-btn {
                width: 100%;
            }
        }
        
        /* === –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–• –§–£–ù–ö–¶–ò–ô === */
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–º–∞–π–ª–∏–∫–æ–≤ */
        .emoji-btn {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 10px;
        }
        
        .emoji-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π */
        .attachment-btn {
            background: linear-gradient(135deg, #9C27B0 0%, #673AB7 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 10px;
            position: relative;
        }
        
        .attachment-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.3);
        }
        
        /* –ú–µ–Ω—é –≤–ª–æ–∂–µ–Ω–∏–π */
        .attachment-menu {
            position: absolute;
            bottom: 70px;
            left: 20px;
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            min-width: 200px;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .attachment-menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.2s;
            color: #333;
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        
        .attachment-menu-item:hover {
            background: #f5f5f5;
            transform: translateX(5px);
        }
        
        .attachment-menu-item .icon {
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
        }
        
        .attachment-menu-item .text {
            flex: 1;
            font-weight: 500;
        }
        
        .attachment-menu-item .shortcut {
            color: #888;
            font-size: 0.85rem;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .send-btn.microphone-mode {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
            content: "üé§";
        }
        
        .send-btn.microphone-mode:hover {
            background: linear-gradient(135deg, #0D47A1 0%, #0a2e5e 100%);
        }
        
        /* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Ñ–∞–π–ª–æ–≤ */
        .file-input-hidden {
            display: none;
        }
        
        /* –ü–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤ */
        .emoji-picker {
            position: absolute;
            bottom: 70px;
            left: 20px;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        .emoji-category {
            margin-bottom: 20px;
        }
        
        .emoji-category-title {
            font-weight: 600;
            color: #2c5364;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
        }
        
        .emoji-item {
            font-size: 1.5rem;
            cursor: pointer;
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .emoji-item:hover {
            background: #f0f0f0;
            transform: scale(1.2);
        }
        
        /* –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 999;
            display: none;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        @media (max-width: 768px) {
            .emoji-btn, .attachment-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
                margin-right: 5px;
            }
            
            .attachment-menu, .emoji-picker {
                left: 10px;
                right: 10px;
                bottom: 60px;
                width: calc(100% - 20px);
            }
            
            .emoji-picker {
                max-height: 300px;
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ñ–∞–π–ª–∞–º–∏ */
        .file-message {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #e9ecef;
        }
        
        .file-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .file-icon {
            font-size: 2rem;
            color: #2c5364;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            word-break: break-all;
        }
        
        .file-size {
            font-size: 0.85rem;
            color: #666;
        }
        
        .download-btn {
            background: #2c5364;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .download-btn:hover {
            background: #203a43;
            transform: translateY(-2px);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–Ω–æ–ø–∫–µ */
        .send-btn.recording {
            animation: pulse 1s infinite;
            background: #dc3545;
        }
        
        .send-btn.recording:hover {
            background: #c82333;
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div class="login-container" id="loginScreen">
        <div class="logo">üîå</div>
        <h1>–≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –°–æ–æ–±—â–µ—Å—Ç–≤–æ ¬´Electric Group</h1>
        <p class="subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –¥–ª—è –æ–±–º–µ–Ω–∞ –æ–ø—ã—Ç–æ–º, –æ–±—Å—É–∂–¥–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —Ä–µ—à–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á</p>
        
        <div class="online-stats">
            <span class="online-count" id="onlineCount">0</span>
            <span class="online-label">—ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤ –æ–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</span>
        </div>
        
        <button class="google-btn" id="googleLoginBtn">
            <img src="https://www.google.com/favicon.ico" alt="Google">
            –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
        </button>
        
        <div class="benefits">
            <h3><span>‚ö°</span> –ß—Ç–æ –¥–∞—ë—Ç –Ω–∞—à —á–∞—Ç —ç–ª–µ–∫—Ç—Ä–∏–∫–∞–º:</h3>
            <ul>
                <li>–û–±—Å—É–∂–¥–∞–µ–º –ª—é–±—ã–µ –º–æ–Ω—Ç–∞–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏</li>
                <li>–ü–æ–º–æ–≥–∞–µ–º —Å –ü–£–≠ –∏ –¥—Ä—É–≥–∏–º–∏ –Ω–æ—Ä–º–∞–º–∏</li>
                <li>–ü–æ–¥–±–∏—Ä–∞–µ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</li>
                <li>–û–±–º–µ–Ω–∏–≤–∞–µ–º—Å—è —Å—Ö–µ–º–∞–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</li>
                <li>–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É –Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö</li>
            </ul>
        </div>
        
        <div class="status" id="statusMessage"></div>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
    <div class="chat-container" id="chatScreen">
        <!-- –®–∞–ø–∫–∞ —á–∞—Ç–∞ -->
        <div class="chat-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-details">
                    <h3 id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                    <p id="userEmail">email@example.com</p>
                </div>
            </div>
            
            <div class="chat-stats">
                <div class="online-badge" id="onlineBadge" style="cursor: pointer;">
                    <span class="online-dot"></span>
                    <span id="activeOnlineCount">0</span> –æ–Ω–ª–∞–π–Ω
                </div>
                <button class="back-btn" id="backBtn">–ù–∞–∑–∞–¥</button>
                <button class="logout-btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div class="messages-wrapper">
            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç" -->
            <div class="typing-indicator" id="typingIndicator"></div>
            
            <!-- –ë–ª–æ–∫ –¥–ª—è –ø—Ä–µ–≤—å—é —Ü–∏—Ç–∞—Ç—ã -->
            <div class="quote-preview" id="quotePreview" style="display: none;">
                <div class="quote-content">
                    <strong id="quoteAuthor">–ê–≤—Ç–æ—Ä</strong>
                    <span id="quoteText">–¢–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã...</span>
                    <button class="cancel-quote-btn" id="cancelQuoteBtn">√ó</button>
                </div>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div class="messages-container" id="messagesContainer">
                <div class="message system">
                    <div class="message-content" style="text-align: center; background: #e9ecef; color: #666;">
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤! –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ.
                    </div>
                </div>
            </div>
            
            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
            <div class="message-input-area">
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–º–∞–π–ª–∏–∫–æ–≤ -->
                <button class="emoji-btn" id="emojiBtn" title="–°–º–∞–π–ª–∏–∫–∏">üòä</button>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π -->
                <button class="attachment-btn" id="attachmentBtn" title="–í–ª–æ–∂–µ–Ω–∏—è">üìé</button>
                
                <input type="text" class="message-input" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="1000">
                
                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏/–º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ -->
                <button class="send-btn" id="sendMessageBtn">‚û§</button>
                
                <!-- –°–∫—Ä—ã—Ç—ã–µ input –¥–ª—è —Ñ–∞–π–ª–æ–≤ -->
                <input type="file" id="photoInput" accept="image/*" capture="environment" class="file-input-hidden">
                <input type="file" id="videoInput" accept="video/*" class="file-input-hidden">
                <input type="file" id="documentInput" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt" class="file-input-hidden">
                <input type="file" id="audioInput" accept="audio/*" class="file-input-hidden">
                <input type="file" id="contactInput" accept=".vcf,.vcard" class="file-input-hidden">
            </div>
        </div>
    </div>
    
    <!-- –ú–µ–Ω—é –≤–ª–æ–∂–µ–Ω–∏–π -->
    <div class="attachment-menu" id="attachmentMenu">
        <button class="attachment-menu-item" id="attachPhotoBtn">
            <span class="icon">üì∑</span>
            <span class="text">–§–æ—Ç–æ</span>
            <span class="shortcut">–ö–∞–º–µ—Ä–∞/–ì–∞–ª–µ—Ä–µ—è</span>
        </button>
        <button class="attachment-menu-item" id="attachVideoBtn">
            <span class="icon">üé•</span>
            <span class="text">–í–∏–¥–µ–æ</span>
            <span class="shortcut">–î–æ 100MB</span>
        </button>
        <button class="attachment-menu-item" id="attachDocumentBtn">
            <span class="icon">üìÑ</span>
            <span class="text">–î–æ–∫—É–º–µ–Ω—Ç</span>
            <span class="shortcut">PDF, DOC, TXT</span>
        </button>
        <button class="attachment-menu-item" id="attachAudioBtn">
            <span class="icon">üéµ</span>
            <span class="text">–ê—É–¥–∏–æ</span>
            <span class="shortcut">MP3, WAV</span>
        </button>
        <button class="attachment-menu-item" id="attachContactBtn">
            <span class="icon">üë§</span>
            <span class="text">–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
            <span class="shortcut">vCard</span>
        </button>
        <button class="attachment-menu-item" id="attachLocationBtn">
            <span class="icon">üìç</span>
            <span class="text">–ì–µ–æ–¥–∞–Ω–Ω—ã–µ</span>
            <span class="shortcut">GPS</span>
        </button>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤ -->
    <div class="emoji-picker" id="emojiPicker">
        <div class="emoji-category">
            <div class="emoji-category-title">–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ</div>
            <div class="emoji-grid" id="frequentEmojis">
                <!-- –ß–∞—Å—Ç—ã–µ —ç–º–æ–¥–∑–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">–£–ª—ã–±–∫–∏ –∏ —ç–º–æ—Ü–∏–∏</div>
            <div class="emoji-grid">
                <div class="emoji-item" data-emoji="üòÄ">üòÄ</div>
                <div class="emoji-item" data-emoji="üòÅ">üòÅ</div>
                <div class="emoji-item" data-emoji="üòÇ">üòÇ</div>
                <div class="emoji-item" data-emoji="ü§£">ü§£</div>
                <div class="emoji-item" data-emoji="üòÉ">üòÉ</div>
                <div class="emoji-item" data-emoji="üòÑ">üòÑ</div>
                <div class="emoji-item" data-emoji="üòÖ">üòÖ</div>
                <div class="emoji-item" data-emoji="üòÜ">üòÜ</div>
                <div class="emoji-item" data-emoji="üòâ">üòâ</div>
                <div class="emoji-item" data-emoji="üòä">üòä</div>
                <div class="emoji-item" data-emoji="üòã">üòã</div>
                <div class="emoji-item" data-emoji="üòé">üòé</div>
                <div class="emoji-item" data-emoji="üòç">üòç</div>
                <div class="emoji-item" data-emoji="üòò">üòò</div>
                <div class="emoji-item" data-emoji="ü•∞">ü•∞</div>
                <div class="emoji-item" data-emoji="üòó">üòó</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">–≠–ª–µ–∫—Ç—Ä–∏–∫–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</div>
            <div class="emoji-grid">
                <div class="emoji-item" data-emoji="üîå">üîå</div>
                <div class="emoji-item" data-emoji="üí°">üí°</div>
                <div class="emoji-item" data-emoji="üî¶">üî¶</div>
                <div class="emoji-item" data-emoji="üîã">üîã</div>
                <div class="emoji-item" data-emoji="‚ö°">‚ö°</div>
                <div class="emoji-item" data-emoji="üîß">üîß</div>
                <div class="emoji-item" data-emoji="üî®">üî®</div>
                <div class="emoji-item" data-emoji="‚öôÔ∏è">‚öôÔ∏è</div>
                <div class="emoji-item" data-emoji="üî©">üî©</div>
                <div class="emoji-item" data-emoji="üîó">üîó</div>
                <div class="emoji-item" data-emoji="üìè">üìè</div>
                <div class="emoji-item" data-emoji="üìê">üìê</div>
                <div class="emoji-item" data-emoji="‚öñÔ∏è">‚öñÔ∏è</div>
                <div class="emoji-item" data-emoji="üß∞">üß∞</div>
                <div class="emoji-item" data-emoji="‚öíÔ∏è">‚öíÔ∏è</div>
                <div class="emoji-item" data-emoji="üî¨">üî¨</div>
            </div>
        </div>
    </div>
    
    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
    <div class="menu-overlay" id="menuOverlay"></div>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ -->
    <div class="audio-recording-overlay" id="audioRecordingOverlay" style="display: none;">
        <div class="audio-recording-modal">
            <div class="recording-header">
                <div class="recording-indicator">
                    <span class="recording-dot"></span>
                    <span>–ó–∞–ø–∏—Å—å...</span>
                </div>
                <div class="recording-timer" id="recordingTimer">00:00</div>
            </div>
            
            <div class="audio-visualizer" id="audioVisualizer"></div>
            
            <div class="recording-controls">
                <button class="cancel-recording-btn" id="cancelRecordingBtn">‚ùå –û—Ç–º–µ–Ω–∞</button>
                <button class="stop-recording-btn" id="stopRecordingBtn">‚èπÔ∏è –ó–∞–≤–µ—Ä—à–∏—Ç—å (0:30)</button>
            </div>
            
            <div class="recording-tip">üé§ –ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ. –ú–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥.</div>
        </div>
    </div>
    
    <!-- –ü—Ä–µ–≤—å—é –∞—É–¥–∏–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π -->
    <div class="audio-preview-overlay" id="audioPreviewOverlay" style="display: none;">
        <div class="audio-preview-modal">
            <h3>üéß –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ—Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
            
            <div class="audio-player">
                <audio controls id="audioPreviewPlayer">–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.</audio>
                <div class="audio-duration" id="audioDuration">0:00</div>
            </div>
            
            <div class="preview-controls">
                <button class="delete-audio-btn" id="deleteAudioBtn">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                <button class="send-audio-btn" id="sendAudioBtn">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
            
            <div class="audio-info">
                –†–∞–∑–º–µ—Ä: <span id="audioSize">0 KB</span>
                | –î–ª–∏–Ω–∞: <span id="audioLength">0 —Å–µ–∫</span>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="modal-overlay" id="onlineModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–Ω–ª–∞–π–Ω</h3>
                <button class="modal-close" id="closeOnlineModal">√ó</button>
            </div>
            <div class="modal-body" id="onlineUsersList">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="closeOnlineModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
    // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ==========
    const firebaseConfig = {
        apiKey: "AIzaSyCRJh0fFbJAc6dFz1O21SbjyAaPbMV58xc",
        authDomain: "electrician-chat.firebaseapp.com",
        projectId: "electrician-chat",
        storageBucket: "electrician-chat.firebasestorage.app",
        messagingSenderId: "1005885507362",
        appId: "1:1005885507362:web:c030a98505761b0add877b"
    };

    // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
    let auth, db, storage;
    let chat = null;

    // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function showStatus(message, type) {
        const statusEl = document.getElementById('statusMessage');
        if (!statusEl) return;
        
        statusEl.textContent = message;
        statusEl.className = 'status ' + type;
        statusEl.style.display = 'block';
        
        setTimeout(() => {
            if (statusEl) {
                statusEl.style.display = 'none';
            }
        }, 3000);
    }

    // ========== –ö–õ–ê–°–° –≠–õ–ï–ö–¢–†–ò–ö –ß–ê–¢ ==========
    class ElectricianChat {
        constructor() {
            console.log('üî¥ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ElectricianChat –í–´–ó–í–ê–ù!');
            
            this.user = null;
            this.roomId = 'brotherhood-electricians-chr'; // ‚Üê –ò–°–ü–†–ê–í–¨–¢–ï –≠–¢–û!
            this.unsubscribeMessages = null;
            this.unsubscribeOnline = null;
            this.unsubscribeTyping = null;
            this.firstMessageSent = false;
            this.systemMessageRemoved = false;
            
            // RATE LIMITING
            this.lastMessageTime = 0;
            this.messageCooldown = 3000;
            this.isSending = false;

            // –ê–£–î–ò–û –ü–ï–†–ï–ú–ï–ù–ù–´–ï
            this.mediaRecorder = null;
            this.audioChunks = [];
            this.isRecording = false;
            this.recordingStartTime = null;
            this.recordingTimer = null;
            this.maxRecordingTime = 60000;
            this.currentAudioBlob = null;
            this.audioContext = null;
            this.analyser = null;
            this.visualizerInterval = null;
            this.pendingQuote = null;
            
            // –§–£–ù–ö–¶–ò–û–ù–ê–õ –°–ú–ê–ô–õ–ò–ö–û–í –ò –í–õ–û–ñ–ï–ù–ò–ô
            this.attachmentMenuOpen = false;
            this.emojiPickerOpen = false;
            this.currentFile = null;
            this.isMicrophoneMode = false;
            this.isVoiceRecording = false;
            
            // –ü–†–û–ö–†–£–¢–ö–ê
            this.shouldAutoScroll = true;
            this.userScrolledUp = false;
            
            this.init();
        }
        
        // ========== –ù–ê–ß–ê–õ–û: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        init() {
            this.getDOMElements();
            this.setupEventListeners();
            this.setupAuthListener();
            
            console.log("‚úÖ –ß–∞—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
        }
        
        getDOMElements() {
            this.loginScreen = document.getElementById('loginScreen');
            this.chatScreen = document.getElementById('chatScreen');
            this.googleLoginBtn = document.getElementById('googleLoginBtn');
            this.logoutBtn = document.getElementById('logoutBtn');
            this.userName = document.getElementById('userName');
            this.userEmail = document.getElementById('userEmail');
            this.userAvatar = document.getElementById('userAvatar');
            this.onlineCount = document.getElementById('onlineCount');
            this.activeOnlineCount = document.getElementById('activeOnlineCount');
            this.messagesContainer = document.getElementById('messagesContainer');
            this.messageInput = document.getElementById('messageInput');
            this.sendMessageBtn = document.getElementById('sendMessageBtn');
            this.typingIndicator = document.getElementById('typingIndicator');
            
            // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            this.emojiBtn = document.getElementById('emojiBtn');
            this.attachmentBtn = document.getElementById('attachmentBtn');
            this.attachmentMenu = document.getElementById('attachmentMenu');
            this.emojiPicker = document.getElementById('emojiPicker');
            this.menuOverlay = document.getElementById('menuOverlay');
            
            // –ö–Ω–æ–ø–∫–∏ –≤–ª–æ–∂–µ–Ω–∏–π
            this.attachPhotoBtn = document.getElementById('attachPhotoBtn');
            this.attachVideoBtn = document.getElementById('attachVideoBtn');
            this.attachDocumentBtn = document.getElementById('attachDocumentBtn');
            this.attachAudioBtn = document.getElementById('attachAudioBtn');
            this.attachContactBtn = document.getElementById('attachContactBtn');
            this.attachLocationBtn = document.getElementById('attachLocationBtn');
            
            // Input —Ñ–∞–π–ª–æ–≤
            this.photoInput = document.getElementById('photoInput');
            this.videoInput = document.getElementById('videoInput');
            this.documentInput = document.getElementById('documentInput');
            this.audioInput = document.getElementById('audioInput');
            this.contactInput = document.getElementById('contactInput');
        }
        
        setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
            this.googleLoginBtn.addEventListener('click', () => this.signInWithGoogle());
            this.logoutBtn.addEventListener('click', () => this.signOut());
            
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.addEventListener('click', () => {
                    if (confirm('–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                        window.location.href = 'https://alivu.github.io/';
                    }
                });
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            this.sendMessageBtn.addEventListener('click', () => this.handleSendButtonClick());
            this.messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.handleSendButtonClick();
                }
            });
            
            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
            this.messageInput.addEventListener('input', () => {
                this.updateSendButtonMode();
                this.setTypingStatus(true);
            });
            
            this.messageInput.addEventListener('blur', () => this.setTypingStatus(false));
            
            // –ö–Ω–æ–ø–∫–∞ —Å–º–∞–π–ª–∏–∫–æ–≤
            this.emojiBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                this.toggleEmojiPicker();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π
            this.attachmentBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                this.toggleAttachmentMenu();
            });
            
            // –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
            this.menuOverlay.addEventListener('click', () => {
                this.closeAllMenus();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–º–æ–¥–∑–∏
            this.setupEmojiHandlers();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
            this.setupAttachmentHandlers();
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞
            this.messagesContainer.addEventListener('scroll', () => this.handleScroll());
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
            window.addEventListener('resize', () => {
                if (this.user) {
                    setTimeout(() => this.scrollToBottom(), 300);
                }
            });
            
            // –ê–£–î–ò–û –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
            const audioRecordBtn = document.getElementById('audioRecordBtn');
            const cancelRecordingBtn = document.getElementById('cancelRecordingBtn');
            const stopRecordingBtn = document.getElementById('stopRecordingBtn');
            const deleteAudioBtn = document.getElementById('deleteAudioBtn');
            const sendAudioBtn = document.getElementById('sendAudioBtn');
            
            if (audioRecordBtn) {
                audioRecordBtn.addEventListener('click', () => this.toggleAudioRecording());
            }
            
            if (cancelRecordingBtn) {
                cancelRecordingBtn.addEventListener('click', () => this.cancelAudioRecording());
            }
            
            if (stopRecordingBtn) {
                stopRecordingBtn.addEventListener('click', () => this.stopAudioRecording());
            }
            
            if (deleteAudioBtn) {
                deleteAudioBtn.addEventListener('click', () => this.deleteAudioPreview());
            }
            
            if (sendAudioBtn) {
                sendAudioBtn.addEventListener('click', () => this.sendAudioMessage());
            }
            
            // –¶–∏—Ç–∞—Ç—ã
            const cancelQuoteBtn = document.getElementById('cancelQuoteBtn');
            if (cancelQuoteBtn) {
                cancelQuoteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.cancelQuote();
                });
            }
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–Ω–ª–∞–π–Ω
            const onlineBadge = document.getElementById('onlineBadge');
            if (onlineBadge) {
                onlineBadge.addEventListener('click', () => {
                    document.getElementById('onlineModal').style.display = 'flex';
                });
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const closeBtn1 = document.getElementById('closeOnlineModal');
            const closeBtn2 = document.getElementById('closeOnlineModalBtn');
            const modalOverlay = document.getElementById('onlineModal');
            
            if (closeBtn1) {
                closeBtn1.addEventListener('click', () => {
                    modalOverlay.style.display = 'none';
                });
            }
            if (closeBtn2) {
                closeBtn2.addEventListener('click', () => {
                    modalOverlay.style.display = 'none';
                });
            }
            if (modalOverlay) {
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        modalOverlay.style.display = 'none';
                    }
                });
            }
            
            // ESC –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ü–∏—Ç–∞—Ç—ã
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const quotePreview = document.getElementById('quotePreview');
                    if (quotePreview && quotePreview.style.display === 'block') {
                        this.cancelQuote();
                        this.messageInput.focus();
                    }
                    this.closeAllMenus();
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            document.addEventListener('click', (e) => {
                if (this.attachmentMenuOpen && !this.attachmentMenu.contains(e.target) && !this.attachmentBtn.contains(e.target)) {
                    this.closeAttachmentMenu();
                }
                if (this.emojiPickerOpen && !this.emojiPicker.contains(e.target) && !this.emojiBtn.contains(e.target)) {
                    this.closeEmojiPicker();
                }
            });
        }
        
        setupAuthListener() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    this.onUserSignedIn(user);
                } else {
                    this.onUserSignedOut();
                }
            });
        }
        // ========== –ö–û–ù–ï–¶: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        
        // ========== –ù–ê–ß–ê–õ–û: –ù–û–í–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ ==========
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏/–º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        handleSendButtonClick() {
            if (this.isMicrophoneMode && !this.isVoiceRecording) {
                // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞
                this.startVoiceRecording();
            } else {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                this.sendMessage();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        updateSendButtonMode() {
            const text = this.messageInput.value.trim();
            const sendBtn = this.sendMessageBtn;
            
            if (!text && !this.isVoiceRecording) {
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∂–∏–º –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
                this.isMicrophoneMode = true;
                sendBtn.innerHTML = "üé§";
                sendBtn.classList.add('microphone-mode');
            } else {
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∂–∏–º –æ—Ç–ø—Ä–∞–≤–∫–∏
                this.isMicrophoneMode = false;
                sendBtn.innerHTML = "‚û§";
                sendBtn.classList.remove('microphone-mode');
                sendBtn.classList.remove('recording');
            }
        }
        
        // –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        startVoiceRecording() {
            if (this.isVoiceRecording) return;
            
            this.isVoiceRecording = true;
            this.sendMessageBtn.classList.add('recording');
            this.sendMessageBtn.innerHTML = "‚è∫Ô∏è";
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–∞
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showStatus("üé§ –ù–∞—á–∞—Ç–∞ –∑–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...", "info");
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å –Ω–∞ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            setTimeout(() => {
                this.stopVoiceRecording();
            }, 5000);
        }
        
        stopVoiceRecording() {
            if (!this.isVoiceRecording) return;
            
            this.isVoiceRecording = false;
            this.sendMessageBtn.classList.remove('recording');
            this.updateSendButtonMode();
            
            showStatus("‚úÖ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∞–Ω–æ (–¥–µ–º–æ)", "success");
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–µ–º–æ-—Å–æ–æ–±—â–µ–Ω–∏–µ
            setTimeout(() => {
                this.sendMessage("üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–µ–º–æ)");
            }, 500);
        }
        
        // –ú–µ–Ω—é –≤–ª–æ–∂–µ–Ω–∏–π
        toggleAttachmentMenu() {
            if (this.attachmentMenuOpen) {
                this.closeAttachmentMenu();
            } else {
                this.openAttachmentMenu();
            }
        }
        
        openAttachmentMenu() {
            this.closeAllMenus();
            this.attachmentMenu.style.display = 'block';
            this.menuOverlay.style.display = 'block';
            this.attachmentMenuOpen = true;
        }
        
        closeAttachmentMenu() {
            this.attachmentMenu.style.display = 'none';
            this.menuOverlay.style.display = 'none';
            this.attachmentMenuOpen = false;
        }
        
        // –ü–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤
        toggleEmojiPicker() {
            if (this.emojiPickerOpen) {
                this.closeEmojiPicker();
            } else {
                this.openEmojiPicker();
            }
        }
        
        openEmojiPicker() {
            this.closeAllMenus();
            this.emojiPicker.style.display = 'block';
            this.menuOverlay.style.display = 'block';
            this.emojiPickerOpen = true;
        }
        
        closeEmojiPicker() {
            this.emojiPicker.style.display = 'none';
            this.menuOverlay.style.display = 'none';
            this.emojiPickerOpen = false;
        }
        
        closeAllMenus() {
            this.closeAttachmentMenu();
            this.closeEmojiPicker();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —ç–º–æ–¥–∑–∏
        setupEmojiHandlers() {
            const emojiItems = this.emojiPicker.querySelectorAll('.emoji-item');
            emojiItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    const emoji = item.getAttribute('data-emoji');
                    this.insertEmoji(emoji);
                    this.addToFrequentEmojis(emoji);
                });
            });
        }
        
        // –í—Å—Ç–∞–≤–∫–∞ —ç–º–æ–¥–∑–∏ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        insertEmoji(emoji) {
            const input = this.messageInput;
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            
            input.value = text.substring(0, start) + emoji + text.substring(end);
            input.selectionStart = input.selectionEnd = start + emoji.length;
            input.focus();
            
            this.updateSendButtonMode();
            this.closeEmojiPicker();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –≤ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
        addToFrequentEmojis(emoji) {
            const frequentGrid = document.getElementById('frequentEmojis');
            if (!frequentGrid) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —ç—Ç–æ —ç–º–æ–¥–∑–∏
            const existing = Array.from(frequentGrid.children).find(item => 
                item.getAttribute('data-emoji') === emoji
            );
            
            if (!existing) {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —ç–º–æ–¥–∑–∏
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.setAttribute('data-emoji', emoji);
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', (e) => {
                    this.insertEmoji(emoji);
                });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ 16
                if (frequentGrid.children.length >= 16) {
                    frequentGrid.removeChild(frequentGrid.lastChild);
                }
                
                frequentGrid.insertBefore(emojiItem, frequentGrid.firstChild);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–ª–æ–∂–µ–Ω–∏–π
        setupAttachmentHandlers() {
            // –§–æ—Ç–æ
            this.attachPhotoBtn.addEventListener('click', () => {
                this.photoInput.click();
                this.closeAttachmentMenu();
            });
            
            this.photoInput.addEventListener('change', (e) => {
                this.handleFileSelect(e, 'photo');
            });
            
            // –í–∏–¥–µ–æ
            this.attachVideoBtn.addEventListener('click', () => {
                this.videoInput.click();
                this.closeAttachmentMenu();
            });
            
            this.videoInput.addEventListener('change', (e) => {
                this.handleFileSelect(e, 'video');
            });
            
            // –î–æ–∫—É–º–µ–Ω—Ç—ã
            this.attachDocumentBtn.addEventListener('click', () => {
                this.documentInput.click();
                this.closeAttachmentMenu();
            });
            
            this.documentInput.addEventListener('change', (e) => {
                this.handleFileSelect(e, 'document');
            });
            
            // –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã
            this.attachAudioBtn.addEventListener('click', () => {
                this.audioInput.click();
                this.closeAttachmentMenu();
            });
            
            this.audioInput.addEventListener('change', (e) => {
                this.handleFileSelect(e, 'audio');
            });
            
            // –ö–æ–Ω—Ç–∞–∫—Ç—ã
            this.attachContactBtn.addEventListener('click', () => {
                this.contactInput.click();
                this.closeAttachmentMenu();
            });
            
            this.contactInput.addEventListener('change', (e) => {
                this.handleFileSelect(e, 'contact');
            });
            
            // –ì–µ–æ–¥–∞–Ω–Ω—ã–µ
            this.attachLocationBtn.addEventListener('click', () => {
                this.getLocation();
                this.closeAttachmentMenu();
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        handleFileSelect(event, type) {
            const file = event.target.files[0];
            if (!file) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
            const maxSize = {
                'photo': 10 * 1024 * 1024, // 10MB
                'video': 100 * 1024 * 1024, // 100MB
                'document': 20 * 1024 * 1024, // 20MB
                'audio': 10 * 1024 * 1024, // 10MB
                'contact': 1 * 1024 * 1024 // 1MB
            }[type];
            
            if (file.size > maxSize) {
                showStatus(`‚ùå –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç ${maxSize/(1024*1024)}MB`, "error");
                return;
            }
            
            this.currentFile = { file, type };
            this.previewFile(file, type);
        }
        
        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞
        previewFile(file, type) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–µ–≤—å—é
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
            this.sendFileMessage(file, type);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
        getLocation() {
            if (!navigator.geolocation) {
                showStatus("‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º", "error");
                return;
            }
            
            showStatus("üìç –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...", "info");
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    this.sendLocationMessage(latitude, longitude);
                },
                (error) => {
                    let message = "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: ";
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = "‚ùå –î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = "‚ùå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";
                            break;
                        case error.TIMEOUT:
                            message = "‚ùå –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ";
                            break;
                    }
                    showStatus(message, "error");
                }
            );
        }
        
        // ========== –ö–û–ù–ï–¶: –ù–û–í–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ ==========
        
        // ========== –ù–ê–ß–ê–õ–û: –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò ==========
        
        async signInWithGoogle() {
            try {
                const googleProvider = new firebase.auth.GoogleAuthProvider();
                googleProvider.addScope('profile');
                googleProvider.addScope('email');
                googleProvider.setCustomParameters({ prompt: 'select_account' });
                
                showStatus("–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Google...", "info");
                const result = await auth.signInWithPopup(googleProvider);
                this.user = result.user;
                
                await this.saveUserToFirestore(this.user);
                showStatus("‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!", "success");
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
                let errorMessage = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ";
                
                if (error.code === 'auth/popup-blocked') {
                    errorMessage += "–ë—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ.";
                } else if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = "–û–∫–Ω–æ –≤—Ö–æ–¥–∞ –±—ã–ª–æ –∑–∞–∫—Ä—ã—Ç–æ";
                } else {
                    errorMessage += error.message;
                }
                
                showStatus(errorMessage, "error");
            }
        }
        
        async saveUserToFirestore(user) {
            try {
                await db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    displayName: user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫',
                    email: user.email,
                    photoURL: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'E')}&background=2c5364&color=fff`,
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp(),
                    isOnline: true,
                    profession: 'electrician',
                    joinedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Firestore");
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
            }
        }
        
        async signOut() {
            try {
                if (this.user) {
                    await db.collection('rooms').doc(this.roomId)
                        .collection('online').doc(this.user.uid).delete();
                    
                    await db.collection('rooms').doc(this.roomId)
                        .collection('typing').doc(this.user.uid).delete();
                }
                
                this.firstMessageSent = false;
                this.systemMessageRemoved = false;
                await auth.signOut();
                showStatus("‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã", "success");
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error);
                showStatus("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ: " + error.message, "error");
            }
        }
        
        onUserSignedIn(user) {
            this.user = user;
            
            this.userName.textContent = user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫';
            this.userEmail.textContent = user.email || '';
            
            if (user.photoURL) {
                this.userAvatar.innerHTML = `<img src="${user.photoURL}" alt="${user.displayName}">`;
            } else {
                const name = user.displayName || 'E';
                this.userAvatar.innerHTML = `<div style="width:100%;height:100%;background:#2c5364;color:white;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.2rem;">${name.charAt(0).toUpperCase()}</div>`;
            }
            
            this.loginScreen.style.display = 'none';
            this.chatScreen.style.display = 'flex';
            
            // –°–ë–†–û–°–ò–ú –§–õ–ê–ì–ò –ü–†–ò –í–•–û–î–ï
            this.systemMessageRemoved = false;
            this.firstMessageSent = false;
            
            this.loadOnlineUsers();
            this.subscribeToMessages(); // ‚Üê –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            this.subscribeToTyping();
            this.addUserToOnline();
            
            setTimeout(() => {
                this.messageInput.focus();
            }, 100);
        }
        
        onUserSignedOut() {
            this.user = null;
            
            if (this.unsubscribeMessages) this.unsubscribeMessages();
            if (this.unsubscribeOnline) this.unsubscribeOnline();
            if (this.unsubscribeTyping) this.unsubscribeTyping();
            
            this.chatScreen.style.display = 'none';
            this.loginScreen.style.display = 'block';
            
            this.firstMessageSent = false;
            this.systemMessageRemoved = false;
            this.shouldAutoScroll = true;
            this.userScrolledUp = false;
            
            this.messagesContainer.innerHTML = `
                <div class="message system">
                    <div class="message-content" style="text-align: center; background: #e9ecef; color: #666;">
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤! –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ.
                    </div>
                </div>
            `;
        }
        
        async addUserToOnline() {
            if (!this.user) return;
            
            try {
                await db.collection('rooms').doc(this.roomId)
                    .collection('online').doc(this.user.uid).set({
                        uid: this.user.uid,
                        name: this.user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫',
                        email: this.user.email,
                        photoURL: this.user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(this.user.displayName || 'E')}&background=2c5364&color=fff`,
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    });
                
                setInterval(() => {
                    if (this.user) {
                        db.collection('rooms').doc(this.roomId)
                            .collection('online').doc(this.user.uid).update({
                                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                            });
                    }
                }, 30000);
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –æ–Ω–ª–∞–π–Ω:", error);
            }
        }
        
        async loadOnlineUsers() {
            try {
                const onlineRef = db.collection('rooms').doc(this.roomId).collection('online');
                
                this.unsubscribeOnline = onlineRef.onSnapshot((snapshot) => {
                    let onlineCount = 0;
                    snapshot.forEach((doc) => {
                        const user = doc.data();
                        const lastSeen = user.lastSeen ? user.lastSeen.toDate() : new Date();
                        const isActive = (new Date() - lastSeen) < 120000;
                        
                        if (isActive) onlineCount++;
                    });
                    
                    if (this.onlineCount) this.onlineCount.textContent = onlineCount;
                    if (this.activeOnlineCount) this.activeOnlineCount.textContent = onlineCount;
                    
                }, (error) => {
                    console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", error);
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", error);
            }
        }
        
        updateSendButton(isSending) {
            const sendBtn = document.getElementById('sendMessageBtn');
            if (!sendBtn) return;
            
            if (isSending) {
                sendBtn.innerHTML = "‚è≥";
                sendBtn.style.opacity = "0.7";
                sendBtn.style.cursor = "not-allowed";
                sendBtn.disabled = true;
            } else {
                sendBtn.innerHTML = this.isMicrophoneMode ? "üé§" : "‚û§";
                sendBtn.style.opacity = "1";
                sendBtn.style.cursor = "pointer";
                sendBtn.disabled = false;
            }
        }
        
        async sendMessage(textOverride = null) {
            const now = Date.now();
            const timeSinceLastMessage = now - this.lastMessageTime;
            
            if (timeSinceLastMessage < this.messageCooldown) {
                const remainingTime = Math.ceil((this.messageCooldown - timeSinceLastMessage) / 1000);
                showStatus(`‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remainingTime} —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π`, "error");
                return;
            }
            
            if (this.isSending) {
                showStatus("‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...", "info");
                return;
            }
            
            if (!this.user) {
                showStatus("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É", "error");
                return;
            }
            
            const text = textOverride || this.messageInput.value.trim();
            if (!text) {
                if (document.getElementById('quotePreview').style.display === 'block') {
                    this.cancelQuote();
                    showStatus("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è", "info");
                }
                return;
            }
            
            try {
                this.isSending = true;
                this.lastMessageTime = Date.now();
                this.updateSendButton(true);
                
                if (!this.firstMessageSent) {
                    this.firstMessageSent = true;
                    this.systemMessageRemoved = true;
                    
                    // –£–¥–∞–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    const systemMsg = this.messagesContainer.querySelector('.message.system');
                    if (systemMsg) {
                        systemMsg.remove();
                    }
                }
                
                
                const messageData = {
                    text: text,
                    userId: this.user.uid,
                    userName: this.user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫',
                    userEmail: this.user.email,
                    userPhoto: this.user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(this.user.displayName || 'E')}&background=2c5364&color=fff`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    isElectrician: true
                };
                
                const quotePreview = document.getElementById('quotePreview');
                if (quotePreview && quotePreview.style.display === 'block') {
                    const quoteId = quotePreview.getAttribute('data-quote-id');
                    const quoteAuthor = quotePreview.getAttribute('data-quote-author');
                    const quoteText = quotePreview.getAttribute('data-quote-text');
                    
                    if (quoteId && quoteAuthor && quoteText) {
                        messageData.replyTo = {
                            messageId: quoteId,
                            author: quoteAuthor,
                            text: quoteText
                        };
                    }
                }
                
                await db.collection('rooms').doc(this.roomId)
                    .collection('messages').add(messageData);
                
                this.isSending = false;
                this.updateSendButton(false);
                this.messageInput.value = '';
                this.cancelQuote();
                this.setTypingStatus(false);
                this.shouldAutoScroll = true;
                
                showStatus("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ" + (messageData.replyTo ? " —Å —Ü–∏—Ç–∞—Ç–æ–π" : ""), "success");
                
            } catch (error) {
                this.isSending = false;
                this.updateSendButton(false);
                
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", error.code, error.message);
                
                let errorMessage = "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ";
                if (error.code === 'permission-denied') {
                    errorMessage = "‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.";
                } else if (error.code === 'unauthenticated') {
                    errorMessage = "‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.";
                    setTimeout(() => this.signOut(), 2000);
                } else {
                    errorMessage += error.message;
                }
                
                showStatus(errorMessage, "error");
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞
        async sendFileMessage(file, type) {
            if (!this.user || !file) return;
            
            try {
                showStatus(`üì§ –ó–∞–≥—Ä—É–∑–∫–∞ ${type}...`, "info");
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
                const timestamp = Date.now();
                const fileExtension = file.name.split('.').pop();
                const fileName = `files/${this.user.uid}/${timestamp}.${fileExtension}`;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ Firebase Storage
                const storageRef = storage.ref(fileName);
                const uploadTask = storageRef.put(file);
                
                const snapshot = await uploadTask;
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∞–π–ª–æ–º
                const messageData = {
                    type: 'file',
                    fileType: type,
                    fileName: file.name,
                    fileUrl: downloadURL,
                    fileSize: Math.round(file.size / 1024),
                    fileExtension: fileExtension,
                    userId: this.user.uid,
                    userName: this.user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫',
                    userEmail: this.user.email,
                    userPhoto: this.user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(this.user.displayName || 'E')}&background=2c5364&color=fff`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    isElectrician: true
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –µ—Å—Ç—å
                const text = this.messageInput.value.trim();
                if (text) {
                    messageData.text = text;
                }
                
                await db.collection('rooms').doc(this.roomId)
                    .collection('messages').add(messageData);
                
                showStatus(`‚úÖ ${this.getFileTypeLabel(type)} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`, "success");
                
                // –û—á–∏—â–∞–µ–º
                this.messageInput.value = '';
                this.currentFile = null;
                this.updateSendButtonMode();
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞:", error);
                showStatus("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞: " + error.message, "error");
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
        async sendLocationMessage(latitude, longitude) {
            try {
                const messageData = {
                    type: 'location',
                    latitude: latitude,
                    longitude: longitude,
                    userId: this.user.uid,
                    userName: this.user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫',
                    userEmail: this.user.email,
                    userPhoto: this.user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(this.user.displayName || 'E')}&background=2c5364&color=fff`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    isElectrician: true
                };
                
                await db.collection('rooms').doc(this.roomId)
                    .collection('messages').add(messageData);
                
                showStatus("üìç –ì–µ–æ–¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!", "success");
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö:", error);
                showStatus("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö", "error");
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∫–∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
        getFileTypeLabel(type) {
            const labels = {
                'photo': '–§–æ—Ç–æ',
                'video': '–í–∏–¥–µ–æ',
                'document': '–î–æ–∫—É–º–µ–Ω—Ç',
                'audio': '–ê—É–¥–∏–æ',
                'contact': '–ö–æ–Ω—Ç–∞–∫—Ç'
            };
            return labels[type] || '–§–∞–π–ª';
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ –≤–∞—à–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–¥–µ—Å—å
        
        subscribeToMessages() {
            console.log('üîµ subscribeToMessages –í–´–ó–í–ê–ù');
            
            if (this.unsubscribeMessages) this.unsubscribeMessages();
            
            // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            this.messagesContainer.innerHTML = '';
            if (!this.systemMessageRemoved) {
                this.messagesContainer.innerHTML = `
                    <div class="message system">
                        <div class="message-content" style="text-align: center; background: #e9ecef; color: #666;">
                            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–≤! –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ.
                        </div>
                    </div>
                `;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
            this.unsubscribeMessages = db.collection('rooms').doc(this.roomId)
                .collection('messages')
                .orderBy('timestamp', 'asc') // ‚Üê –ò–°–ü–†–ê–í–õ–ï–ù–û: 'asc' –≤–º–µ—Å—Ç–æ 'desc'
                .limit(50)
                .onSnapshot((snapshot) => {
                    const messages = [];
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        const docId = doc.id;
                        messages.push({ message, docId });
                    });
                    
                    // –û—á–∏—â–∞–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    if (this.systemMessageRemoved) {
                        this.messagesContainer.innerHTML = '';
                    } else {
                        // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        const systemMsg = this.messagesContainer.querySelector('.message.system');
                        if (systemMsg) {
                            this.messagesContainer.innerHTML = '';
                            this.messagesContainer.appendChild(systemMsg);
                        }
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É
                    messages.forEach(({ message, docId }) => {
                        if (!document.querySelector(`[data-message-id="${docId}"]`)) {
                            this.displayMessage(message, docId);
                        }
                    });
                    
                    // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                    setTimeout(() => {
                        this.shouldAutoScroll = true;
                        this.scrollToBottom();
                    }, 300);
                    
                }, (error) => {
                    console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
                });
        }
        
        displayMessage(message, docId) {
            const isOwnMessage = message.userId === this.user?.uid;
            const messageTime = message.timestamp ? 
                new Date(message.timestamp.toDate()).toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }) : 
                new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const editedBadge = message.edited ? 
                `<span class="edited-badge">(—Ä–µ–¥.)</span>` : '';
            
            // === –ü–ï–†–ï–ú–ï–°–¢–ò–¢–ï –≠–¢–û –í –ù–ê–ß–ê–õ–û –ú–ï–¢–û–î–ê ===
            // –ê–í–ê–¢–ê–†–ö–ê –°–õ–ï–í–ê
            const avatarHtml = `
                <div class="message-avatar-left">
                    ${message.userPhoto ? 
                        `<img src="${message.userPhoto}" alt="${message.userName}">` : 
                        `<div style="width:100%;height:100%;background:#2c5364;color:white;display:flex;align-items:center;justify-content:center;font-weight:bold;">
                            ${(message.userName || 'E').charAt(0).toUpperCase()}
                        </div>`
                    }
                </div>
            `;
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            const messageEl = document.createElement('div');
            messageEl.className = `message ${isOwnMessage ? 'sent' : 'received'}`;
            messageEl.setAttribute('data-message-id', docId);
            
            let finalContent = '';
            
            // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∞–π–ª–æ–º
            if (message.type === 'file') {
                const fileIcon = this.getFileIcon(message.fileType);
                finalContent = `
                    ${avatarHtml}
                    <div class="message-content-with-avatar">
                        <div class="file-message">
                            <div class="file-preview">
                                <div class="file-icon">${fileIcon}</div>
                                <div class="file-info">
                                    <div class="file-name">${escapeHtml(message.fileName)}</div>
                                    <div class="file-size">${message.fileSize} KB ‚Ä¢ ${message.fileExtension.toUpperCase()}</div>
                                </div>
                                <button class="download-btn" onclick="window.open('${message.fileUrl}', '_blank')">üì•</button>
                            </div>
                            ${message.text ? `<div style="margin-top:10px;color:#333;">${escapeHtml(message.text)}</div>` : ''}
                            <div style="text-align:right;margin-top:10px;color:#666;font-size:0.8em;">
                                ${messageTime}
                            </div>
                        </div>
                    </div>
                `;
            }
            // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏
            else if (message.type === 'location') {
                const mapUrl = `https://maps.google.com/?q=${message.latitude},${message.longitude}`;
                finalContent = `
                    ${avatarHtml}
                    <div class="message-content-with-avatar">
                        <div class="file-message">
                            <div class="file-preview">
                                <div class="file-icon">üìç</div>
                                <div class="file-info">
                                    <div class="file-name">–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è</div>
                                    <div class="file-size">–®–∏—Ä–æ—Ç–∞: ${message.latitude.toFixed(6)}<br>–î–æ–ª–≥–æ—Ç–∞: ${message.longitude.toFixed(6)}</div>
                                </div>
                                <button class="download-btn" onclick="window.open('${mapUrl}', '_blank')">üó∫Ô∏è</button>
                            </div>
                            <div style="text-align:right;margin-top:10px;color:#666;font-size:0.8em;">
                                ${messageTime}
                            </div>
                        </div>
                    </div>
                `;
            }
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ü–∏—Ç–∞—Ç–∞ - —Å–æ–∑–¥–∞–µ–º —Å–ª–æ–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            else if (message.replyTo) {
                let quoteContent = '';
                
                if (message.replyTo.type === 'audio') {
                    quoteContent = `
                        <div class="inner-quote-frame">
                            <div class="quote-author-inner">${message.replyTo.author || '–≠–ª–µ–∫—Ç—Ä–∏–∫'}</div>
                            <div class="quote-audio-info">
                                <span class="quote-audio-icon">üé§</span>
                                <span class="quote-audio-duration">${message.replyTo.audioDuration || '0:00'}</span>
                            </div>
                        </div>
                    `;
                } else {
                    const quoteText = message.replyTo.text || '';
                    const shortContent = quoteText.length > 80 ? quoteText.substring(0, 80) + '...' : quoteText;
                    
                    quoteContent = `
                        <div class="inner-quote-frame">
                            <div class="quote-author-inner">${message.replyTo.author || '–≠–ª–µ–∫—Ç—Ä–∏–∫'}</div>
                            <div class="quote-text-inner">${escapeHtml(shortContent)}</div>
                        </div>
                    `;
                }
                
                finalContent = `
                    ${avatarHtml}
                    <div class="message-content-with-avatar">
                        <div class="message-with-quote">
                            <!-- –†–ê–ú–ö–ê –¶–ò–¢–ê–¢–´ -->
                            <div class="quote-frame">
                                ${quoteContent}
                            </div>
                            
                            <!-- –ò–ú–Ø –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø –í–ù–£–¢–†–ò –†–ê–ú–ö–ò -->
                            <div class="message-sender-inside">${message.userName || '–≠–ª–µ–∫—Ç—Ä–∏–∫'}</div>
                            
                            <!-- –ê–£–î–ò–û –ü–õ–ï–ô–ï–† -->
                            <div class="audio-player-frame">
                                <div class="audio-controls-row">
                                    <button class="play-btn-audio" id="play-btn-audio-${docId}">
                                        <span class="play-icon">‚ñ∂</span>
                                        <span class="pause-icon" style="display:none;">‚è∏</span>
                                    </button>
                                    <div class="waveform-container" id="wave-container-audio-${docId}">
                                        <div class="audio-waveform" id="wave-audio-${docId}">
                                            ${this.generateWaveform(20)}
                                        </div>
                                        <div class="audio-progress" id="progress-audio-${docId}"></div>
                                    </div>
                                </div>
                                <div class="audio-time-info">
                                    <span class="audio-current-time" id="current-time-audio-${docId}">0:00</span>
                                    <span class="audio-duration" id="duration-audio-${docId}">${message.audioDuration || '0:00'}</span>
                                    <span class="message-time-audio">${messageTime}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç
                finalContent += `
                    <audio id="audio-${docId}" preload="metadata" style="display: none;">
                        <source src="data:audio/webm;base64,${message.audioData}" type="audio/webm">
                    </audio>
                `;
            } 
            // –ï—Å–ª–∏ –ù–ï–¢ —Ü–∏—Ç–∞—Ç—ã - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
            else if (message.type === 'audio' && message.audioData) {
                finalContent = `
                    ${avatarHtml}
                    <div class="message-content-with-avatar">
                        <div class="simple-audio-frame">
                            <!-- –ò–ú–Ø –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø –í–ù–£–¢–†–ò –†–ê–ú–ö–ò -->
                            <div class="message-sender-inside">${message.userName || '–≠–ª–µ–∫—Ç—Ä–∏–∫'}</div>
                            
                            <div class="audio-controls-row">
                                <button class="play-btn-audio" id="play-btn-audio-${docId}">
                                    <span class="play-icon">‚ñ∂</span>
                                    <span class="pause-icon" style="display:none;">‚è∏</span>
                                </button>
                                <div class="waveform-container" id="wave-container-audio-${docId}">
                                    <div class="audio-waveform" id="wave-audio-${docId}">
                                        ${this.generateWaveform(20)}
                                    </div>
                                    <div class="audio-progress" id="progress-audio-${docId}"></div>
                                </div>
                            </div>
                            <div class="audio-time-info">
                                <span class="audio-current-time" id="current-time-audio-${docId}">0:00</span>
                                <span class="audio-duration" id="duration-audio-${docId}">${message.audioDuration || '0:00'}</span>
                                <span class="message-time-audio">${messageTime}</span>
                            </div>
                        </div>
                    </div>
                    <audio id="audio-${docId}" preload="metadata" style="display: none;">
                        <source src="data:audio/webm;base64,${message.audioData}" type="audio/webm">
                    </audio>
                `;
            } else {
                // –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                finalContent = `
                    ${avatarHtml}
                    <div class="message-content-with-avatar">
                        <div class="text-message-frame">
                            <!-- –ò–ú–Ø –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø –í–ù–£–¢–†–ò –†–ê–ú–ö–ò -->
                            <div class="message-sender-inside">${message.userName || '–≠–ª–µ–∫—Ç—Ä–∏–∫'}</div>
                            <div class="message-text-content">
                                ${escapeHtml(message.text || '')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            messageEl.innerHTML = finalContent;
            
            this.messagesContainer.appendChild(messageEl);
            this.addMessageActions(messageEl, message, docId);
            
            if (this.shouldAutoScroll) {
                setTimeout(() => this.scrollToBottom(), 100);
            }
            
            return messageEl;
        }
        
        getFileIcon(fileType) {
            const icons = {
                'photo': 'üì∑',
                'video': 'üé•',
                'document': 'üìÑ',
                'audio': 'üéµ',
                'contact': 'üë§'
            };
            return icons[fileType] || 'üìé';
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        
        async setTypingStatus(isTyping) {
            if (!this.user) return;
            
            try {
                if (isTyping) {
                    await db.collection('rooms').doc(this.roomId)
                        .collection('typing').doc(this.user.uid).set({
                            userId: this.user.uid,
                            userName: this.user.displayName || '–≠–ª–µ–∫—Ç—Ä–∏–∫',
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                } else {
                    await db.collection('rooms').doc(this.roomId)
                        .collection('typing').doc(this.user.uid).delete();
                }
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞–±–æ—Ä–∞:", error);
            }
        }
        
        subscribeToTyping() {
            this.unsubscribeTyping = db.collection('rooms').doc(this.roomId)
                .collection('typing')
                .onSnapshot((snapshot) => {
                    const typingUsers = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.userId !== this.user?.uid) {
                            typingUsers.push(data.userName || '–≠–ª–µ–∫—Ç—Ä–∏–∫');
                        }
                    });
                    
                    this.showTypingIndicator(typingUsers);
                }, (error) => {
                    console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –Ω–∞–±–æ—Ä —Ç–µ–∫—Å—Ç–∞:", error);
                });
        }
        
        showTypingIndicator(typingUsers) {
            if (typingUsers.length > 0) {
                const names = typingUsers.slice(0, 2).join(', ');
                const others = typingUsers.length > 2 ? ` –∏ ${typingUsers.length - 2} –¥—Ä—É–≥–∏—Ö` : '';
                this.typingIndicator.textContent = `${names}${others} –ø–µ—á–∞—Ç–∞–µ—Ç...`;
                this.typingIndicator.style.display = 'block';
            } else {
                this.typingIndicator.style.display = 'none';
            }
        }
        
        handleScroll() {
            const container = this.messagesContainer;
            const scrollBottom = container.scrollHeight - container.scrollTop - container.clientHeight;
            
            if (scrollBottom <= 50) {
                this.shouldAutoScroll = true;
                this.userScrolledUp = false;
            } else if (container.scrollTop > 0) {
                this.shouldAutoScroll = false;
                this.userScrolledUp = true;
            }
            
            if (scrollBottom === 0) {
                this.shouldAutoScroll = true;
                this.userScrolledUp = false;
            }
        }
        
        scrollToBottom() {
            if (this.shouldAutoScroll) {
                // –î–≤–∞ –≤—ã–∑–æ–≤–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                setTimeout(() => {
                    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                }, 50);
                
                setTimeout(() => {
                    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                }, 150);
            }
        }
        
        // –ê—É–¥–∏–æ —Ñ—É–Ω–∫—Ü–∏–∏ (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        async toggleAudioRecording() {
            if (this.isRecording) {
                this.stopAudioRecording();
                return;
            }
            
            try {
                // –°–û–•–†–ê–ù–ò –¶–ò–¢–ê–¢–£ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∑–∞–ø–∏—Å–∏
                this.saveCurrentQuoteState();
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: { 
                        echoCancellation: true, 
                        noiseSuppression: true, 
                        autoGainControl: true 
                    } 
                });
                this.startAudioRecording(stream);
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:", error);
                this.showAudioError(error);
            }
        }
        
        startAudioRecording(stream) {
            console.log("=== –ù–ê–ß–ê–õ–û –ó–ê–ü–ò–°–ò –ê–£–î–ò–û ===");
            
            try {
                this.isRecording = true;
                this.audioChunks = [];
                this.recordingStartTime = Date.now();
                
                // –°–æ–∑–¥–∞–µ–º MediaRecorder
                const options = { mimeType: 'audio/webm' };
                this.mediaRecorder = new MediaRecorder(stream, options);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö
                this.mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        this.audioChunks.push(event.data);
                    }
                };
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                this.mediaRecorder.onstop = () => {
                    if (this.audioChunks.length > 0) {
                        this.currentAudioBlob = new Blob(this.audioChunks, { 
                            type: 'audio/webm' 
                        });
                        
                        // –û—á–∏—Å—Ç–∫–∞
                        this.cleanupRecording();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                        this.showAudioPreview();
                    } else {
                        console.error("‚ùå –ù–µ—Ç –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö!");
                        this.handleRecordingError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –∞—É–¥–∏–æ");
                    }
                };
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å
                this.mediaRecorder.start(100);
                
                // UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const audioBtn = document.getElementById('audioRecordBtn');
                if (audioBtn) audioBtn.classList.add('recording');
                
                document.getElementById('audioRecordingOverlay').style.display = 'flex';
                
                // –¢–∞–π–º–µ—Ä
                this.startRecordingTimer();
                
                // –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä
                this.startAudioVisualizer(stream);
                
                console.log("‚úÖ –ó–∞–ø–∏—Å—å –Ω–∞—á–∞—Ç–∞");
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏:", error);
                this.isRecording = false;
                this.showAudioError(error);
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
            }
        }
        
        // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞—É–¥–∏–æ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞...
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ª–Ω—ã
        generateWaveform(waveCount = 10) {
            let waveHtml = '';
            
            for (let i = 0; i < waveCount; i++) {
                const sineValue = Math.sin(i * 0.8) * 0.5 + 0.5;
                const height = Math.floor(1 + (sineValue * 6));
                
                waveHtml += `<div class="wave-bar" style="height:${height}px"></div>`;
            }
            return waveHtml;
        }
        
        formatTime(date) {
            if (!date) {
                date = new Date();
            }
            
            const dateObj = date instanceof Date ? date : new Date(date);
            
            if (isNaN(dateObj.getTime())) {
                return '--:--';
            }
            
            return dateObj.toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ –≤–∞—à–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞...
        
        // ========== –ö–û–ù–ï–¶: –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò ==========
    }

    // ========== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==========
    window.addEventListener('load', async function() {
        console.log("üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º...");
        
        try {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            const app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            storage = firebase.storage();
            
            console.log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
            
            // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —á–∞—Ç–∞
            chat = new ElectricianChat();
            
            console.log("‚úÖ –ß–∞—Ç –≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –°–æ–æ–±—â–µ—Å—Ç–≤–æ ¬´Electric Group –∑–∞–≥—Ä—É–∂–µ–Ω!");
            showStatus("–ß–∞—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!", "success");
            
        } catch (error) {
            console.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–∞—Ç:", error);
            showStatus("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞: " + error.message, "error");
        }
    });
    </script>
</body>
</html>
